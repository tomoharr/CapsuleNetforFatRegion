# README #

卒業論文「カプセルネットワークを用いたCT画像からの脂肪領域抽出」についてのリポジトリです.
This is a repository for my bachelar thesis, "Segmentation of Fat Region on CT Images using Capsule Network".

## ABOUT ##

### ABSTRACT ###

医療現場において, 近年の人工知能技術, 取り分け深層学習の発達をもとに, ニューラルネットワークをはじめとする深層学習を用いた画像処理技術により医用画像診断を支援する研究が多く為されている. 医用画像の深層学習では, 特定の臓器や器官などに対応する領域を画像上で色分けするセグメンテーション(抽出)の機械学習手法が用いられる. 医用画像のセグメンテーションは, 医師の読影を補助する, あるいは画像内から特定領域を抽出し, 別の診断アーキテクチャが診断を行うために前処理と画像のマスキングを行うなどの利点があるため, 様々な手法が研究されている.
医用画像の診断でしばしば課題になるのが, 組織の形状や位置などの医用画像間 での特徴差である. 身体の断層面の画像であるCTやMRの医用画像において, 部位によっては, 撮影する身体上の位置がわずかに移動するだけで画像内の組織の特徴が大きく変化する. つまり, 組織同士の形状および位置関係に差異がある状態となる. よって, このような部位におけるニューラルネットワークを用いた画像診断 では, 特徴差を持った医用画像という条件下で全ての画像に対し同一の高い精度で抽出ないしは検出を行うことが求められる.
さらに深層学習では, 分類や抽出などのタスクの特徴を学習する際に大量のデータが必要となる. データ量の確保が重要となるが, 症例数の少なさや, 医師等の専門家による注釈 (アノテーション) 付きのデータを大量に得るコストなど観点から必ずしも多くのデータを得られるとは限らないのが実情である.
そこで本研究では, 撮影位置の移動で組織の形状が大きく変化し, かつ組織の位置関係に個人差がみられる部位の医用画像に対して, 高精度のセグメンテーションが可能なモデルを導出することを目的とする. また, そのモデルが, 学習サンプルのデータ量が少量の段階においても特徴を学習可能であり, 未学習データに対して高精度に抽出が可能であることを示す.
本論文では, 画面内の物体の構造や位置関係の認識と学習に優れた性質を持つカプセルネットワークを用いたモデルを, 画像同士特徴の差があり, データ量の少ない医用画像のセグメンテーションに適用する. 学習するデータに関するこれらの条件下において, カプセルネットワークの特徴たるカプセルレイヤーによる空間的な特徴の認識が, ピクセルレベルでの従来型の学習手法と比較して高い精度での領域抽出を可能とすることを示す.

### SETTING ###

### RESULT ###

## NOTE  ##

* 実行環境はPython3.6.7
* ネットワークのアーキテクチャおよびコードはRodney LaLonde, Ulas Bagci :“Capsules for Object Segmentation”, 1st Conference on Medical Imaging with Deep Learning (MIDL 2018), 2018.より引用()
* ところどころ元のコードではエラーが発生する箇所があるので改変してある
* 画像の処理に用いられていたSimpleITKがマイナーすぎて仕様が不明だったためOpenCV(cv2)に換装

## FILES ##

### CODES ###

* main.py
* capsnet.py : カプセルネットワークのアーキテクチャ(ルーティング回数は3回)
* capsule_layers.py : カプセルネットワークのカプセル層
* subpixel_upscaling.py : ネットワークのアップスケール部分
* model_helper.py : モデル読み込み
* custom_data_aug.py : データ拡張
* custom_losses.py : 損失関数
* metrics.py : 計算部分
* densenets.pyc : tiramisuのネットワークモデル
* load_3D_data.py : または画像ファイルからnumpyファイルを作成
* train.py : 学習
* test.py : テスト

画像ファイルの処理用

* pre.py : 画像の前処理に用いたコード

### RESULSTS ###
./results/

* capsule : カプセルネットワークを用いたセグメンテーション結果
* tiramisu : 比較手法tiramisuでのセグメンテーション結果

### THESIS ###

* short.pdf : 卒論概要
* thesis.pdf : 卒論
